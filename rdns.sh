#!/bin/bash

# ANSI color codes
RED='\033[0;31m'
NC='\033[0m' # No Color

# Display usage message and exit
usage() {
  echo "Usage: $0 <input_file>"
  exit 1
}

# Process command-line options
while [ $# -gt 0 ]; do
  case $1 in
    -h|--help)
      usage
      ;;
    *)
      if [ ! -f "$1" ]; then
        echo -e "${RED}Error:${NC} Input file '$1' not found"
        exit 1
      fi
      input_file="$1"
      break
      ;;
  esac
done

# Check if the input file was provided
if [ -z "${input_file}" ]; then
  usage
fi

while read ip; do
  # Perform reverse DNS lookup
  rdns=$(dig +short -x "$ip")

  # Check if reverse DNS lookup succeeded
  if [ $? -ne 0 ]; then
    echo -e "${RED}Error:${NC} Failed to perform reverse DNS lookup for $ip"
    continue
  fi

  # Check if rDNS is set
  if [[ -n $rdns ]]; then
    # Extract hostname from rdns output
    hostname=$(echo "$rdns" | grep -oP 'name = \K[^,]+')
    echo "$ip,$hostname"
  else
    echo "$ip,No rDNS set"
  fi
done < "$input_file"
