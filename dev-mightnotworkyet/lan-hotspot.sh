#!/bin/bash

# LAN Hotspot Script for Kali Linux with hostapd.conf settings

# Configuration variables
INTERFACE_WLAN="wlan0"
INTERFACE_ETH="eth1" # Change to eth0 if your internet is on eth0
IP_RANGE_WLAN="10.0.0.0/24"
IP_WLAN="10.0.0.1"
SSID="leon_corp" # Set your desired SSID here
PASSPHRASE="leon_pass" # Set your desired password here
HOSTAPD_CONF="/etc/hostapd/hostapd.conf"

# Color codes
RED='\033[0;31m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color

# Check for root privileges
if [[ $EUID -ne 0 ]]; then
   echo -e "${RED}This script must be run as root or with sudo privileges.${NC}"
   exit 1
fi

# Function to print usage
print_usage() {
    echo "Usage: $0 [--start|--stop|--help]"
    echo "  --start: Set up and start the hotspot"
    echo "  --stop: Stop the hotspot and revert changes"
    echo "  --help: Display this help message"
}

# Function to configure and start the hotspot
start_hotspot() {
    echo -e "${GREEN}Starting Hotspot...${NC}"
    echo -e "SSID: ${SSID}"
    echo -e "Password: ${PASSPHRASE}"

    # Create hostapd.conf
    cat > $HOSTAPD_CONF <<EOF
interface=$INTERFACE_WLAN
driver=nl80211
ssid=$SSID
hw_mode=g
channel=6
wmm_enabled=0
macaddr_acl=0
auth_algs=1
ignore_broadcast_ssid=0
wpa=2
wpa_passphrase=$PASSPHRASE
wpa_key_mgmt=WPA-PSK
wpa_pairwise=TKIP
rsn_pairwise=CCMP
EOF

    # Enable IP forwarding
    echo 1 > /proc/sys/net/ipv4/ip_forward

    # Configure IP address for WLAN interface
    ifconfig $INTERFACE_WLAN $IP_WLAN netmask 255.255.255.0

    # Set up NAT
    iptables -t nat -A POSTROUTING -o $INTERFACE_ETH -j MASQUERADE
    iptables -A FORWARD -i $INTERFACE_ETH -o $INTERFACE_WLAN -m state --state RELATED,ESTABLISHED -j ACCEPT
    iptables -A FORWARD -i $INTERFACE_WLAN -o $INTERFACE_ETH -j ACCEPT

    # Start hostapd and dnsmasq
    systemctl start hostapd
    systemctl start dnsmasq

    echo -e "${GREEN}Hotspot started.${NC}"
}

# Function to stop the hotspot
stop_hotspot() {
    echo -e "${RED}Stopping Hotspot...${NC}"

    # Disable IP forwarding
    echo 0 > /proc/sys/net/ipv4/ip_forward

    # Flush NAT settings
    iptables -t nat -F
    iptables -F

    # Stop hostapd and dnsmasq
    systemctl stop hostapd
    systemctl stop dnsmasq

    echo -e "${RED}Hotspot stopped.${NC}"
}

# Main script logic
case "$1" in
    --start)
        start_hotspot
        ;;
    --stop)
        stop_hotspot
        ;;
    --help)
        print_usage
        ;;
    *)
        echo -e "${RED}Invalid option: $1${NC}"
        print_usage
        ;;
esac

